<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting started with nwps • nwps</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with nwps">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nwps</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/nwps.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UI-Research/nwps" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting started with nwps</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/UI-Research/nwps/blob/main/vignettes/nwps.Rmd" class="external-link"><code>vignettes/nwps.Rmd</code></a></small>
      <div class="d-none name"><code>nwps.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ui-research.github.io/nwps/">nwps</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/UrbanInstitute/urbnthemes" class="external-link">urbnthemes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/urbnthemes/man/set_urbn_defaults.html" class="external-link">set_urbn_defaults</a></span><span class="op">(</span>style <span class="op">=</span> <span class="st">"print"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use the `linewidth` argument instead.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">urbnthemes</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue at</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB; font-style: italic;">&lt;https://github.com/UrbanInstitute/urbnthemes/issues&gt;</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; Warning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use the `linewidth` argument instead.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">urbnthemes</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue at</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB; font-style: italic;">&lt;https://github.com/UrbanInstitute/urbnthemes/issues&gt;</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The nwps package provides R functions to access the <a href="https://api.water.noaa.gov/nwps/v1/" class="external-link">National Water Prediction
Service (NWPS) API</a>. The NWPS API offers hydrological data
including:</p>
<ul>
<li>Gauge metadata and current status</li>
<li>Stage and flow observations and forecasts</li>
<li>Flood categories and impact statements</li>
<li>Stage-to-flow rating curves</li>
<li>National Water Model (NWM) streamflow forecasts</li>
</ul>
<p>This vignette demonstrates how to use each of the package’s core
functions.</p>
</div>
<div class="section level2">
<h2 id="finding-gauges">Finding gauges<a class="anchor" aria-label="anchor" href="#finding-gauges"></a>
</h2>
<div class="section level3">
<h3 id="list-all-gauges-in-an-area">List all gauges in an area<a class="anchor" aria-label="anchor" href="#list-all-gauges-in-an-area"></a>
</h3>
<p>Use <code><a href="../reference/nwps_gauges.html">nwps_gauges()</a></code> to retrieve gauges within a bounding
box. The function returns an sf object with point geometries.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get gauges in the Washington DC area</span></span>
<span><span class="va">dc_gauges</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nwps_gauges.html">nwps_gauges</a></span><span class="op">(</span></span>
<span>  bbox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">77.5</span>, <span class="fl">38.5</span>, <span class="op">-</span><span class="fl">76.5</span>, <span class="fl">39.5</span><span class="op">)</span>,</span>
<span>  srid <span class="op">=</span> <span class="st">"EPSG_4326"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dc_gauges</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">lid</span>, <span class="va">name</span>, <span class="va">state_abbreviation</span>, <span class="va">status_observed_flood_category</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 189 features and 4 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -77.4763 ymin: 38.54577 xmax: -76.53142 ymax: 39.48944</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 189 × 5</span></span></span>
<span><span class="co">#&gt;    lid   name                          state_abbreviation status_observed_floo…¹</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ABPV2 Backlick Run at Armistead Bo… VA                 no_flooding           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ACRV2 Cameron Run at Alexandria     VA                 out_of_service        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> AFRV2 Four Mile Run at Alexandria   VA                 no_flooding           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ALEV2 Four Mile Run above Highway … VA                 no_flooding           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ANAD2 Anacostia River at Washingto… DC                 out_of_service        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ANAV2 Accotink Creek near Annandale VA                 no_flooding           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> APSV2 Unnamed Tributary at New Ale… VA                 no_flooding           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ATGV2 Unnamed Tributary above New … VA                 no_flooding           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> AXTV2 Potomac River at Alexandria   VA                 no_flooding           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> BBSV2 Buckhall Branch at Signal Hi… VA                 not_defined           </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 179 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​status_observed_flood_category</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: geometry &lt;POINT [°]&gt;</span></span></span></code></pre></div>
<p>You can also filter to gauges with CatFIM (Categorical Flood
Inundation Mapping) configuration:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">catfim_gauges</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nwps_gauges.html">nwps_gauges</a></span><span class="op">(</span></span>
<span>  bbox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">77.5</span>, <span class="fl">38.5</span>, <span class="op">-</span><span class="fl">76.5</span>, <span class="fl">39.5</span><span class="op">)</span>,</span>
<span>  catfim <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; No gauges found matching the specified criteria.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">catfim_gauges</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="getting-gauge-details">Getting gauge details<a class="anchor" aria-label="anchor" href="#getting-gauge-details"></a>
</h2>
<div class="section level3">
<h3 id="retrieve-gauge-metadata">Retrieve gauge metadata<a class="anchor" aria-label="anchor" href="#retrieve-gauge-metadata"></a>
</h3>
<p>Use <code><a href="../reference/nwps_gauge.html">nwps_gauge()</a></code> to get detailed metadata for a specific
gauge by its LID or USGS ID. The function returns a list with multiple
components.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gauge</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nwps_gauge.html">nwps_gauge</a></span><span class="op">(</span><span class="st">"PTTP1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Basic metadata (as sf object)</span></span>
<span><span class="va">gauge</span><span class="op">$</span><span class="va">metadata</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 12 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -80.01083 ymin: 40.43944 xmax: -80.01083 ymax: 40.43944</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 13</span></span></span>
<span><span class="co">#&gt;   lid   usgs_id  reach_id name   description latitude longitude time_zone county</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> PTTP1 03085152 3786893  Ohio … <span style="color: #949494;">""</span>              40.4     -<span style="color: #BB0000;">80.0</span> EST5EDT   Alleg…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: in_service &lt;lgl&gt;, in_service_message &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   forecast_reliability &lt;chr&gt;, geometry &lt;POINT [°]&gt;</span></span></span>
<span></span>
<span><span class="co"># Organizational affiliations</span></span>
<span><span class="va">gauge</span><span class="op">$</span><span class="va">organizations</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 6</span></span></span>
<span><span class="co">#&gt;   rfc_abbreviation rfc_name         wfo_abbreviation wfo_name state_abbreviation</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> OHRFC            Ohio River Fore… PBZ              Moon To… PA                </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: state_name &lt;chr&gt;</span></span></span>
<span></span>
<span><span class="co"># Flood category thresholds</span></span>
<span><span class="va">gauge</span><span class="op">$</span><span class="va">flood_categories</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">#&gt;   category stage stage_units  flow flow_units</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> action      18 ft          -<span style="color: #BB0000; text-decoration: underline;">9</span><span style="color: #BB0000;">999</span> cfs       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> minor       22 ft          -<span style="color: #BB0000; text-decoration: underline;">9</span><span style="color: #BB0000;">999</span> cfs       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> moderate    25 ft          -<span style="color: #BB0000; text-decoration: underline;">9</span><span style="color: #BB0000;">999</span> cfs       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> major       28 ft          -<span style="color: #BB0000; text-decoration: underline;">9</span><span style="color: #BB0000;">999</span> cfs</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="view-flood-impact-statements">View flood impact statements<a class="anchor" aria-label="anchor" href="#view-flood-impact-statements"></a>
</h3>
<p>Many gauges have stage-based impact statements describing what
happens at different water levels:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gauge</span><span class="op">$</span><span class="va">flood_impacts</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 24 × 2</span></span></span>
<span><span class="co">#&gt;    stage statement                                                              </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  46   Severe damage occurs in Pittsburgh with up to 15 feet of water in the …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  40   PNC Park is flooded along Federal Street.                              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  38   Water reaches the floor of Brunots Island Power Station.               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  37   Water reaches the floor level of Rivers Casino.                        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  36.6 Steam distribution lines in Pittsburgh are in jeopardy. Water reaches …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  36   Serious flood damage occurs to about 500 businesses on the North Side …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  35.8 Flood waters reach the historic levels of Hurricane Agnes on June 26, …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  35   The river level reaches a critical stage for Acrisure Stadium and PNC …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  32   Mckees Rocks is affected. Flooding occurs on Neville Island.           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  31   Water reaches the railroad tracks at Station Square on the South Side.…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 14 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="historical-flood-crests">Historical flood crests<a class="anchor" aria-label="anchor" href="#historical-flood-crests"></a>
</h3>
<p>You can also access historical and recent flood crest records:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gauge</span><span class="op">$</span><span class="va">flood_crests</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">stage</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 6</span></span></span>
<span><span class="co">#&gt;   type     occurred_time       stage  flow preliminary old_datum</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> historic 1936-03-18 <span style="color: #949494;">00:00:00</span>  46       0 R           FALSE    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> recent   1936-03-18 <span style="color: #949494;">00:00:00</span>  46       0 R           FALSE    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> historic 1907-03-15 <span style="color: #949494;">00:00:00</span>  38.5     0 O           FALSE    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> recent   1907-03-15 <span style="color: #949494;">00:00:00</span>  38.5     0 O           FALSE    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> historic 1942-12-31 <span style="color: #949494;">00:00:00</span>  36.6     0 O           FALSE</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="stage-and-flow-time-series">Stage and flow time series<a class="anchor" aria-label="anchor" href="#stage-and-flow-time-series"></a>
</h2>
<div class="section level3">
<h3 id="get-observed-and-forecast-data">Get observed and forecast data<a class="anchor" aria-label="anchor" href="#get-observed-and-forecast-data"></a>
</h3>
<p>Use <code><a href="../reference/nwps_gauge_stageflow.html">nwps_gauge_stageflow()</a></code> to retrieve stage and flow
time series. By default, it returns both observed and forecast data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stageflow</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nwps_gauge_stageflow.html">nwps_gauge_stageflow</a></span><span class="op">(</span><span class="st">"PTTP1"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stageflow</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">product</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    n_obs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    min_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">valid_time</span><span class="op">)</span>,</span>
<span>    max_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">valid_time</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   product  n_obs min_time            max_time           </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> forecast    20 2026-01-04 <span style="color: #949494;">18:00:00</span> 2026-01-09 <span style="color: #949494;">12:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> observed  <span style="text-decoration: underline;">8</span>595 2025-12-05 <span style="color: #949494;">19:40:00</span> 2026-01-04 <span style="color: #949494;">19:00:00</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualize-the-hydrograph">Visualize the hydrograph<a class="anchor" aria-label="anchor" href="#visualize-the-hydrograph"></a>
</h3>
<p>Plot the observed and forecast stages alongside flood thresholds:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flood_cats</span> <span class="op">&lt;-</span> <span class="va">gauge</span><span class="op">$</span><span class="va">flood_categories</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">stageflow</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">valid_time</span>, y <span class="op">=</span> <span class="va">primary</span>, color <span class="op">=</span> <span class="va">product</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">flood_cats</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">stage</span>, linetype <span class="op">=</span> <span class="va">category</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"gray40"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"action"</span> <span class="op">=</span> <span class="st">"dotted"</span>, <span class="st">"minor"</span> <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>               <span class="st">"moderate"</span> <span class="op">=</span> <span class="st">"longdash"</span>, <span class="st">"major"</span> <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="va">gauge</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">name</span>,</span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Stage ("</span>, <span class="va">stageflow</span><span class="op">$</span><span class="va">primary_units</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">")"</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Product"</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"Flood Category"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The `scale_name` argument of `discrete_scale()` is deprecated as of ggplot2</span></span>
<span><span class="co">#&gt; 3.5.0.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<p><img src="nwps_files/figure-html/hydrograph-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="get-only-observed-or-forecast-data">Get only observed or forecast data<a class="anchor" aria-label="anchor" href="#get-only-observed-or-forecast-data"></a>
</h3>
<p>You can request just one product type:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">observed_only</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nwps_gauge_stageflow.html">nwps_gauge_stageflow</a></span><span class="op">(</span><span class="st">"PTTP1"</span>, product <span class="op">=</span> <span class="st">"observed"</span><span class="op">)</span></span>
<span><span class="va">forecast_only</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nwps_gauge_stageflow.html">nwps_gauge_stageflow</a></span><span class="op">(</span><span class="st">"PTTP1"</span>, product <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">observed_only</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8596</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">forecast_only</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 20</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="stage-to-flow-ratings">Stage-to-flow ratings<a class="anchor" aria-label="anchor" href="#stage-to-flow-ratings"></a>
</h2>
<div class="section level3">
<h3 id="get-the-rating-curve">Get the rating curve<a class="anchor" aria-label="anchor" href="#get-the-rating-curve"></a>
</h3>
<p>Use <code><a href="../reference/nwps_gauge_ratings.html">nwps_gauge_ratings()</a></code> to retrieve the stage-to-flow
rating curve for a gauge:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ratings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nwps_gauge_ratings.html">nwps_gauge_ratings</a></span><span class="op">(</span><span class="st">"PTTP1"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ratings</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   stage stage_units  flow flow_units</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  16.3 ft              0 cfs       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  16.4 ft            500 cfs       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  16.5 ft           <span style="text-decoration: underline;">2</span>000 cfs       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  16.6 ft          <span style="text-decoration: underline;">40</span>009 cfs       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  16.7 ft          <span style="text-decoration: underline;">70</span>016 cfs       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  16.8 ft          <span style="text-decoration: underline;">95</span>021 cfs</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualize-the-rating-curve">Visualize the rating curve<a class="anchor" aria-label="anchor" href="#visualize-the-rating-curve"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ratings</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">stage</span>, y <span class="op">=</span> <span class="va">flow</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Stage-to-Flow Rating Curve"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="va">gauge</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">name</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Stage ("</span>, <span class="va">ratings</span><span class="op">$</span><span class="va">stage_units</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">")"</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Flow ("</span>, <span class="va">ratings</span><span class="op">$</span><span class="va">flow_units</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">")"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="nwps_files/figure-html/rating-curve-1.png" class="r-plt" alt="" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="national-water-model-data">National Water Model data<a class="anchor" aria-label="anchor" href="#national-water-model-data"></a>
</h2>
<p>The NWPS API also provides access to National Water Model (NWM)
streamflow forecasts by reach.</p>
<div class="section level3">
<h3 id="get-reach-metadata">Get reach metadata<a class="anchor" aria-label="anchor" href="#get-reach-metadata"></a>
</h3>
<p>Use <code><a href="../reference/nwps_reach.html">nwps_reach()</a></code> to retrieve metadata for an NWM
reach:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reach</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nwps_reach.html">nwps_reach</a></span><span class="op">(</span><span class="st">"22338099"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">reach</span><span class="op">$</span><span class="va">metadata</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 4 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -76.9508 ymin: 38.9149 xmax: -76.9508 ymax: 38.9149</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">#&gt;   reach_id name            latitude longitude           geometry</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;POINT [°]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 22338099 Beaverdam Creek     38.9     -<span style="color: #BB0000;">77.0</span> (-76.9508 38.9149)</span></span>
<span><span class="va">reach</span><span class="op">$</span><span class="va">streamflow_products</span></span>
<span><span class="co">#&gt; [1] "analysis_assimilation" "short_range"           "long_range"           </span></span>
<span><span class="co">#&gt; [4] "medium_range_blend"    "medium_range"</span></span></code></pre></div>
<p>The <code>upstream</code> and <code>downstream</code> tibbles show
the reach network routing:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">reach</span><span class="op">$</span><span class="va">upstream</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   reach_id stream_order</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 22338093 4           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 22338095 4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">reach</span><span class="op">$</span><span class="va">downstream</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   reach_id stream_order</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 22338123 4</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get-nwm-streamflow-forecasts">Get NWM streamflow forecasts<a class="anchor" aria-label="anchor" href="#get-nwm-streamflow-forecasts"></a>
</h3>
<p>Use <code><a href="../reference/nwps_reach_streamflow.html">nwps_reach_streamflow()</a></code> to retrieve streamflow
forecasts. Different forecast series are available:</p>
<ul>
<li>
<code>"analysis_assimilation"</code>: Analysis and assimilation
(recent past)</li>
<li>
<code>"short_range"</code>: Short-range forecast (0-18 hours)</li>
<li>
<code>"medium_range"</code>: Medium-range ensemble forecast (0-10
days)</li>
<li>
<code>"medium_range_blend"</code>: Blended medium-range
forecast</li>
<li>
<code>"long_range"</code>: Long-range ensemble forecast (0-30
days)</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">short_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nwps_reach_streamflow.html">nwps_reach_streamflow</a></span><span class="op">(</span><span class="st">"22338099"</span>, series <span class="op">=</span> <span class="st">"short_range"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">short_range</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 7</span></span></span>
<span><span class="co">#&gt;    reach_id series    member reference_time      valid_time           flow units</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 22338099 short_ra… series 2026-01-04 <span style="color: #949494;">16:00:00</span> 2026-01-04 <span style="color: #949494;">17:00:00</span>  54.4 ft³/s</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 22338099 short_ra… series 2026-01-04 <span style="color: #949494;">16:00:00</span> 2026-01-04 <span style="color: #949494;">18:00:00</span>  55.4 ft³/s</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 22338099 short_ra… series 2026-01-04 <span style="color: #949494;">16:00:00</span> 2026-01-04 <span style="color: #949494;">19:00:00</span>  58.6 ft³/s</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 22338099 short_ra… series 2026-01-04 <span style="color: #949494;">16:00:00</span> 2026-01-04 <span style="color: #949494;">20:00:00</span>  62.9 ft³/s</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 22338099 short_ra… series 2026-01-04 <span style="color: #949494;">16:00:00</span> 2026-01-04 <span style="color: #949494;">21:00:00</span>  68.5 ft³/s</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 22338099 short_ra… series 2026-01-04 <span style="color: #949494;">16:00:00</span> 2026-01-04 <span style="color: #949494;">22:00:00</span>  74.2 ft³/s</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 22338099 short_ra… series 2026-01-04 <span style="color: #949494;">16:00:00</span> 2026-01-04 <span style="color: #949494;">23:00:00</span>  78.4 ft³/s</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 22338099 short_ra… series 2026-01-04 <span style="color: #949494;">16:00:00</span> 2026-01-05 <span style="color: #949494;">00:00:00</span>  81.9 ft³/s</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 22338099 short_ra… series 2026-01-04 <span style="color: #949494;">16:00:00</span> 2026-01-05 <span style="color: #949494;">01:00:00</span>  84.0 ft³/s</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 22338099 short_ra… series 2026-01-04 <span style="color: #949494;">16:00:00</span> 2026-01-05 <span style="color: #949494;">02:00:00</span>  84.8 ft³/s</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualize-nwm-forecasts">Visualize NWM forecasts<a class="anchor" aria-label="anchor" href="#visualize-nwm-forecasts"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">short_range</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">valid_time</span>, y <span class="op">=</span> <span class="va">flow</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"NWM Short-Range Streamflow Forecast"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Reach:"</span>, <span class="va">reach</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">reach_id</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Flow ("</span>, <span class="va">short_range</span><span class="op">$</span><span class="va">units</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">")"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="nwps_files/figure-html/nwm-forecast-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="ensemble-forecasts">Ensemble forecasts<a class="anchor" aria-label="anchor" href="#ensemble-forecasts"></a>
</h3>
<p>For medium and long-range forecasts, multiple ensemble members are
available:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">medium_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nwps_reach_streamflow.html">nwps_reach_streamflow</a></span><span class="op">(</span><span class="st">"22338099"</span>, series <span class="op">=</span> <span class="st">"medium_range"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">medium_range</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">member</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 2</span></span></span>
<span><span class="co">#&gt;   member      n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> mean      204</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> member1   240</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> member2   204</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> member3   204</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> member4   204</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> member5   204</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> member6   204</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="shef-product-codes">SHEF product codes<a class="anchor" aria-label="anchor" href="#shef-product-codes"></a>
</h2>
<div class="section level3">
<h3 id="access-data-by-pedts-code">Access data by PEDTS code<a class="anchor" aria-label="anchor" href="#access-data-by-pedts-code"></a>
</h3>
<p>For more granular control, use <code><a href="../reference/nwps_product_stageflow.html">nwps_product_stageflow()</a></code>
to request data by specific SHEF PEDTS (Physical Element Data Type
Source) code:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the PEDTS codes for a gauge</span></span>
<span><span class="va">gauge</span><span class="op">$</span><span class="va">pedts</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   observed forecast</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> HGIR2    HGIFF</span></span>
<span></span>
<span><span class="co"># Request observed data using PEDTS code</span></span>
<span><span class="va">observed_pedts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nwps_product_stageflow.html">nwps_product_stageflow</a></span><span class="op">(</span><span class="st">"PTTP1"</span>, <span class="st">"HGIRG"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">observed_pedts</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 12</span></span></span>
<span><span class="co">#&gt;   pedts issued_time         wfo   time_zone valid_time         </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> HGIRG 2026-01-04 <span style="color: #949494;">19:15:00</span> PBZ   EST5EDT   2025-12-05 <span style="color: #949494;">19:35:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> HGIRG 2026-01-04 <span style="color: #949494;">19:15:00</span> PBZ   EST5EDT   2025-12-05 <span style="color: #949494;">19:40:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> HGIRG 2026-01-04 <span style="color: #949494;">19:15:00</span> PBZ   EST5EDT   2025-12-05 <span style="color: #949494;">19:45:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> HGIRG 2026-01-04 <span style="color: #949494;">19:15:00</span> PBZ   EST5EDT   2025-12-05 <span style="color: #949494;">19:50:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> HGIRG 2026-01-04 <span style="color: #949494;">19:15:00</span> PBZ   EST5EDT   2025-12-05 <span style="color: #949494;">19:55:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> HGIRG 2026-01-04 <span style="color: #949494;">19:15:00</span> PBZ   EST5EDT   2025-12-05 <span style="color: #949494;">20:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7 more variables: generated_time &lt;dttm&gt;, primary &lt;dbl&gt;, primary_name &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   primary_units &lt;chr&gt;, secondary &lt;dbl&gt;, secondary_name &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   secondary_units &lt;chr&gt;</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="system-monitoring">System monitoring<a class="anchor" aria-label="anchor" href="#system-monitoring"></a>
</h2>
<div class="section level3">
<h3 id="check-api-status">Check API status<a class="anchor" aria-label="anchor" href="#check-api-status"></a>
</h3>
<p>Use <code><a href="../reference/nwps_monitor.html">nwps_monitor()</a></code> to check the system health and data
status:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">status</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nwps_monitor.html">nwps_monitor</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Gauges by observed flood category</span></span>
<span><span class="va">status</span><span class="op">$</span><span class="va">gauge_observed</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 3</span></span></span>
<span><span class="co">#&gt;   type     category        count</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> observed action             27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> observed low_threshold      99</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> observed major               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> observed minor               3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> observed moderate            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> observed no_flooding      <span style="text-decoration: underline;">6</span>756</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> observed not_defined      <span style="text-decoration: underline;">3</span>943</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> observed obs_not_current   903</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> observed out_of_service    801</span></span>
<span></span>
<span><span class="co"># Gauges by forecast flood category</span></span>
<span><span class="va">status</span><span class="op">$</span><span class="va">gauge_forecast</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 3</span></span></span>
<span><span class="co">#&gt;   type     category         count</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> forecast action              40</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> forecast fcst_not_current  <span style="text-decoration: underline;">9</span>608</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> forecast low_threshold        8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> forecast minor                6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> forecast moderate             1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> forecast no_flooding       <span style="text-decoration: underline;">1</span>708</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> forecast not_defined        364</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> forecast out_of_service     801</span></span></code></pre></div>
<p>The monitoring endpoint also provides information about data
processing:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># HML product processing stats</span></span>
<span><span class="va">status</span><span class="op">$</span><span class="va">hml_product_counts</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 102 × 2</span></span></span>
<span><span class="co">#&gt;    time_period count</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> t-10day     <span style="text-decoration: underline;">47</span>073</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> t-10hour     <span style="text-decoration: underline;">1</span>963</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> t-11day     <span style="text-decoration: underline;">47</span>112</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> t-11hour     <span style="text-decoration: underline;">1</span>962</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> t-12day     <span style="text-decoration: underline;">47</span>115</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> t-12hour     <span style="text-decoration: underline;">1</span>960</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> t-13day     <span style="text-decoration: underline;">47</span>117</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> t-13hour     <span style="text-decoration: underline;">1</span>959</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> t-14day     <span style="text-decoration: underline;">47</span>032</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> t-14hour     <span style="text-decoration: underline;">1</span>963</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 92 more rows</span></span></span>
<span></span>
<span><span class="co"># Long Range Outlook status</span></span>
<span><span class="va">status</span><span class="op">$</span><span class="va">lro</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   current_lros current_interval</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>          353 JFM</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>The nwps package provides a complete interface to the National Water
Prediction Service API:</p>
<table class="table">
<thead><tr class="header">
<th>Function</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/nwps_gauges.html">nwps_gauges()</a></code></td>
<td>List gauges with spatial filtering</td>
</tr>
<tr class="even">
<td><code><a href="../reference/nwps_gauge.html">nwps_gauge()</a></code></td>
<td>Get detailed gauge metadata</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/nwps_gauge_ratings.html">nwps_gauge_ratings()</a></code></td>
<td>Get stage-to-flow rating curves</td>
</tr>
<tr class="even">
<td><code><a href="../reference/nwps_gauge_stageflow.html">nwps_gauge_stageflow()</a></code></td>
<td>Get observed/forecast stage and flow</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/nwps_reach.html">nwps_reach()</a></code></td>
<td>Get NWM reach metadata</td>
</tr>
<tr class="even">
<td><code><a href="../reference/nwps_reach_streamflow.html">nwps_reach_streamflow()</a></code></td>
<td>Get NWM streamflow forecasts</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/nwps_product_stageflow.html">nwps_product_stageflow()</a></code></td>
<td>Get data by SHEF PEDTS code</td>
</tr>
<tr class="even">
<td><code><a href="../reference/nwps_monitor.html">nwps_monitor()</a></code></td>
<td>Check system status</td>
</tr>
</tbody>
</table>
<p>For more information about the NWPS API, visit the <a href="https://api.water.noaa.gov/nwps/v1/" class="external-link">API documentation</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Will Curran-Groome.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
